<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Star Survivor: Evolution</title>
    <style>
        :root { --main-color: #00ffcc; }
        body { margin: 0; overflow: hidden; background: #1a1a2e; font-family: sans-serif; touch-action: none; color: white; }
        
        /* UI„É¨„Ç§„Ç¢„Ç¶„Éà */
        #game-ui { position: absolute; top: 10px; width: 100%; text-align: center; z-index: 10; pointer-events: none; }
        #score-board { font-size: 24px; text-shadow: 0 0 10px var(--main-color); }
        #high-score { font-size: 14px; opacity: 0.8; }

        /* „Ç≠„É£„É©„ÇØ„Çø„Éº */
        #player { 
            position: absolute; bottom: 30px; width: 70px; height: 70px; 
            font-size: 50px; display: flex; justify-content: center; align-items: center;
            left: 50%; transform: translateX(-50%); z-index: 5;
        }
        .item { position: absolute; font-size: 35px; }

        /* „É°„Éã„É•„ÉºÁîªÈù¢ÂÖ±ÈÄö */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(10, 10, 30, 0.9); display: flex;
            flex-direction: column; justify-content: center; align-items: center; z-index: 100;
        }
        
        /* „Ç≠„É£„É©„ÇØ„Çø„ÉºÈÅ∏Êäû„É™„Çπ„Éà */
        .skin-list { display: flex; gap: 15px; margin: 20px 0; flex-wrap: wrap; justify-content: center; padding: 10px; }
        .skin-item { 
            font-size: 40px; width: 70px; height: 70px; 
            display: flex; align-items: center; justify-content: center;
            border: 2px solid #333; border-radius: 15px; background: #222; cursor: pointer;
            position: relative;
        }
        .skin-item.selected { border-color: var(--main-color); background: #333; }
        .skin-item.locked { filter: grayscale(1) brightness(0.5); }
        .skin-item.locked::after { content: 'üîí'; position: absolute; font-size: 18px; bottom: 5px; right: 5px; }
        .lock-hint { font-size: 12px; color: #aaa; margin-top: 5px; }

        button {
            padding: 15px 40px; font-size: 20px; background: var(--main-color); border: none;
            border-radius: 30px; cursor: pointer; font-weight: bold; color: #1a1a2e;
        }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div id="game-ui">
    <div id="score-board">Score: <span id="current-score">0</span></div>
    <div id="high-score">Best: <span id="best-score">0</span></div>
</div>

<div id="start-menu" class="overlay">
    <h1>STAR SURVIVOR</h1>
    <p>„Ç≠„É£„É©„ÇíÈÅ∏„Çì„Åß„Çπ„Çø„Éº„ÉàÔºÅ</p>
    <div class="skin-list" id="skin-list">
        </div>
    <div id="lock-msg" class="lock-hint">„Éè„Ç§„Çπ„Ç≥„Ç¢„ÅßÊñ∞„Åó„ÅÑ‰ª≤Èñì„ÅåËß£ÊîæÔºÅ</div>
    <br>
    <button onclick="startGame()">START</button>
</div>

<div id="game-over-menu" class="overlay hidden">
    <h1>GAME OVER</h1>
    <p id="final-result"></p>
    <button onclick="backToMenu()">MENU</button>
</div>

<div id="player">üê±</div>

<script>
    // „Ç≠„É£„É©„ÇØ„Çø„ÉºË®≠ÂÆö
    const skins = [
        { icon: 'üê±', name: '„Éç„Ç≥', unlock: 0 },
        { icon: 'ü¶ä', name: '„Ç≠„ÉÑ„Éç', unlock: 50 },
        { icon: 'üê∏', name: '„Ç´„Ç®„É´', unlock: 150 },
        { icon: 'ü§ñ', name: '„É≠„Éú', unlock: 300 },
        { icon: 'üêâ', name: '„Éâ„É©„Ç¥„É≥', unlock: 600 }
    ];

    let currentSkin = localStorage.getItem('selectedSkin') || 'üê±';
    let highScore = parseInt(localStorage.getItem('highScore')) || 0;
    let score = 0;
    let gameActive = false;

    const player = document.getElementById('player');
    const skinListEl = document.getElementById('skin-list');
    const currentScoreEl = document.getElementById('current-score');
    const bestScoreEl = document.getElementById('best-score');

    // ÂàùÊúüË°®Á§∫
    function init() {
        bestScoreEl.innerText = highScore;
        player.innerText = currentSkin;
        renderSkins();
    }

    // „Ç≠„É£„É©„ÇØ„Çø„Éº„É™„Çπ„Éà„ÇíË°®Á§∫
    function renderSkins() {
        skinListEl.innerHTML = '';
        skins.forEach(skin => {
            const item = document.createElement('div');
            const isLocked = highScore < skin.unlock;
            item.className = `skin-item ${isLocked ? 'locked' : ''} ${currentSkin === skin.icon ? 'selected' : ''}`;
            item.innerText = skin.icon;
            
            if (!isLocked) {
                item.onclick = () => {
                    currentSkin = skin.icon;
                    player.innerText = currentSkin;
                    localStorage.setItem('selectedSkin', currentSkin);
                    renderSkins();
                };
            } else {
                item.onclick = () => alert(`„Çπ„Ç≥„Ç¢ ${skin.unlock} „ÅßËß£Êîæ„Åï„Çå„Çã„ÇàÔºÅ`);
            }
            skinListEl.appendChild(item);
        });
    }

    // „Ç≤„Éº„É†ÈñãÂßã
    function startGame() {
        score = 0;
        currentScoreEl.innerText = score;
        gameActive = true;
        document.getElementById('start-menu').classList.add('hidden');
        document.getElementById('game-over-menu').classList.add('hidden');
        player.innerText = currentSkin;
        gameLoop();
    }

    function gameLoop() {
        if (!gameActive) return;
        createItem();
        // Èõ£ÊòìÂ∫¶Ôºö„Çπ„Ç≥„Ç¢„Åå‰∏ä„Åå„Çã„Åª„Å©ÁîüÊàê„ÅåÊó©„Åè„Å™„Çã
        setTimeout(gameLoop, Math.max(250, 1000 - score * 1.5));
    }

    function createItem() {
        const item = document.createElement('div');
        const isBomb = Math.random() < 0.25; 
        item.className = 'item';
        item.innerText = isBomb ? 'üí£' : '‚≠ê';
        item.style.left = Math.random() * (window.innerWidth - 40) + 'px';
        item.style.top = '-50px';
        document.body.appendChild(item);

        let top = -50;
        let fallSpeed = (3 + Math.random() * 3) * (1 + score / 300);

        const fall = setInterval(() => {
            if (!gameActive) { item.remove(); clearInterval(fall); return; }
            top += fallSpeed;
            item.style.top = top + 'px';

            const pRect = player.getBoundingClientRect();
            const iRect = item.getBoundingClientRect();

            if (pRect.left < iRect.right && pRect.right > iRect.left &&
                pRect.top < iRect.bottom && pRect.bottom > iRect.top) {
                if (isBomb) {
                    endGame();
                } else {
                    score += 10;
                    currentScoreEl.innerText = score;
                    item.remove();
                    clearInterval(fall);
                }
            }
            if (top > window.innerHeight) { item.remove(); clearInterval(fall); }
        }, 20);
    }

    function endGame() {
        gameActive = false;
        if (score > highScore) {
            highScore = score;
            localStorage.setItem('highScore', highScore);
            bestScoreEl.innerText = highScore;
        }
        document.getElementById('game-over-menu').classList.remove('hidden');
        document.getElementById('final-result').innerText = `‰ªäÂõû„ÅÆ„Çπ„Ç≥„Ç¢: ${score}`;
    }

    function backToMenu() {
        document.getElementById('game-over-menu').classList.add('hidden');
        document.getElementById('start-menu').classList.remove('hidden');
        renderSkins();
    }

    // Êìç‰Ωú
    window.addEventListener('touchmove', (e) => {
        if (!gameActive) return;
        let x = e.touches[0].clientX;
        x = Math.max(35, Math.min(window.innerWidth - 35, x));
        player.style.left = x + 'px';
    });

    init();
</script>
</body>
</html>
